"use strict";(globalThis.webpackChunkros2_book=globalThis.webpackChunkros2_book||[]).push([[930],{2849(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"module1/python-ros-control","title":"Python-to-ROS Control (rclpy)","description":"Learning Objectives","source":"@site/docs/module1/python-ros-control.md","sourceDirName":"module1","slug":"/module1/python-ros-control","permalink":"/docs/module1/python-ros-control","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/module1/python-ros-control.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"ROS 2 Core Concepts","permalink":"/docs/module1/ros2-core-concepts"},"next":{"title":"URDF for Humanoid Robots","permalink":"/docs/module1/urdf-humanoids"}}');var s=i(4848),l=i(8453);const a={sidebar_position:2},t="Python-to-ROS Control (rclpy)",o={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Introduction to rclpy",id:"introduction-to-rclpy",level:2},{value:"Key Features of rclpy:",id:"key-features-of-rclpy",level:3},{value:"Node Creation and Management",id:"node-creation-and-management",level:2},{value:"Basic Node Structure",id:"basic-node-structure",level:3},{value:"Parameters in rclpy",id:"parameters-in-rclpy",level:2},{value:"Parameter Declaration and Usage",id:"parameter-declaration-and-usage",level:3},{value:"Actions in ROS 2",id:"actions-in-ros-2",level:2},{value:"Action Server Implementation",id:"action-server-implementation",level:3},{value:"Action Client Implementation",id:"action-client-implementation",level:3},{value:"Timer-Based Publishers",id:"timer-based-publishers",level:2},{value:"Timer Implementation",id:"timer-implementation",level:3},{value:"Advanced Publisher/Subscriber Patterns",id:"advanced-publishersubscriber-patterns",level:2},{value:"Quality of Service (QoS) Settings",id:"quality-of-service-qos-settings",level:3},{value:"Publisher with Custom Message Types",id:"publisher-with-custom-message-types",level:3},{value:"Running the Examples",id:"running-the-examples",level:2},{value:"Setup Instructions",id:"setup-instructions",level:3},{value:"Running Parameter Example",id:"running-parameter-example",level:3},{value:"Running Action Example",id:"running-action-example",level:3},{value:"Summary",id:"summary",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"python-to-ros-control-rclpy",children:"Python-to-ROS Control (rclpy)"})}),"\n",(0,s.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,s.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Use the rclpy client library to create ROS 2 nodes in Python"}),"\n",(0,s.jsx)(n.li,{children:"Implement parameterized nodes with configurable behavior"}),"\n",(0,s.jsx)(n.li,{children:"Create and use actions for goal-oriented tasks"}),"\n",(0,s.jsx)(n.li,{children:"Implement timer-based publishers for periodic tasks"}),"\n",(0,s.jsx)(n.li,{children:"Understand advanced publisher/subscriber patterns in rclpy"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"Before starting this chapter, you should have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Completed the ROS 2 Core Concepts chapter"}),"\n",(0,s.jsx)(n.li,{children:"Basic understanding of ROS 2 nodes, topics, and services"}),"\n",(0,s.jsx)(n.li,{children:"Python knowledge including classes and callbacks"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"introduction-to-rclpy",children:"Introduction to rclpy"}),"\n",(0,s.jsx)(n.p,{children:"rclpy is the Python client library for ROS 2. It provides Python bindings for the ROS 2 client library (rcl) and enables Python developers to create ROS 2 nodes, publishers, subscribers, services, and actions."}),"\n",(0,s.jsx)(n.h3,{id:"key-features-of-rclpy",children:"Key Features of rclpy:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Object-oriented API design"}),"\n",(0,s.jsx)(n.li,{children:"Integration with Python's asyncio (optional)"}),"\n",(0,s.jsx)(n.li,{children:"Support for all ROS 2 communication patterns"}),"\n",(0,s.jsx)(n.li,{children:"Parameter management"}),"\n",(0,s.jsx)(n.li,{children:"Logging and lifecycle management"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"node-creation-and-management",children:"Node Creation and Management"}),"\n",(0,s.jsxs)(n.p,{children:["Creating a node in rclpy involves inheriting from the ",(0,s.jsx)(n.code,{children:"Node"})," class and initializing it with a unique name."]}),"\n",(0,s.jsx)(n.h3,{id:"basic-node-structure",children:"Basic Node Structure"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass MyPythonNode(Node):\n    def __init__(self):\n        super().__init__('my_node_name')\n        self.get_logger().info('Node created successfully')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = MyPythonNode()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"parameters-in-rclpy",children:"Parameters in rclpy"}),"\n",(0,s.jsx)(n.p,{children:"Parameters allow nodes to be configured externally. They can be declared with default values and type constraints."}),"\n",(0,s.jsx)(n.h3,{id:"parameter-declaration-and-usage",children:"Parameter Declaration and Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\n\nclass ParameterNode(Node):\n    def __init__(self):\n        super().__init__('parameter_node')\n\n        # Declare parameters with default values\n        self.declare_parameter('frequency', 1.0)\n        self.declare_parameter('message', 'Hello')\n        self.declare_parameter('count', 10)\n\n        # Access parameter values\n        self.frequency = self.get_parameter('frequency').value\n        self.message = self.get_parameter('message').value\n        self.count = self.get_parameter('count').value\n\n        self.get_logger().info(f'Frequency: {self.frequency}, Message: {self.message}, Count: {self.count}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = ParameterNode()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"actions-in-ros-2",children:"Actions in ROS 2"}),"\n",(0,s.jsx)(n.p,{children:"Actions are used for goal-oriented tasks that take time to complete and may be canceled. They provide feedback during execution and result upon completion."}),"\n",(0,s.jsx)(n.h3,{id:"action-server-implementation",children:"Action Server Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionServer\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionServer(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_server')\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            'fibonacci',\n            self.execute_callback)\n\n    def execute_callback(self, goal_handle):\n        self.get_logger().info('Executing goal...')\n\n        feedback_msg = Fibonacci.Feedback()\n        feedback_msg.sequence = [0, 1]\n\n        for i in range(1, goal_handle.request.order):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info('Goal canceled')\n                return Fibonacci.Result()\n\n            feedback_msg.sequence.append(\n                feedback_msg.sequence[i] + feedback_msg.sequence[i-1])\n\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f'Feedback: {feedback_msg.sequence}')\n\n        goal_handle.succeed()\n        result = Fibonacci.Result()\n        result.sequence = feedback_msg.sequence\n        return result\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_server = FibonacciActionServer()\n    try:\n        rclpy.spin(action_server)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        action_server.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h3,{id:"action-client-implementation",children:"Action Client Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\nclass FibonacciActionClient(Node):\n    def __init__(self):\n        super().__init__('fibonacci_action_client')\n        self._action_client = ActionClient(\n            self,\n            Fibonacci,\n            'fibonacci')\n\n    def send_goal(self, order):\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        self._action_client.wait_for_server()\n        self.get_logger().info(f'Sending goal: {order}')\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback)\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected')\n            return\n\n        self.get_logger().info('Goal accepted')\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        self.get_logger().info(f'Received feedback: {feedback_msg.feedback.sequence}')\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info(f'Result: {result.sequence}')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    action_client = FibonacciActionClient()\n\n    try:\n        action_client.send_goal(10)\n        rclpy.spin(action_client)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        action_client.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"timer-based-publishers",children:"Timer-Based Publishers"}),"\n",(0,s.jsx)(n.p,{children:"Timers allow nodes to execute callbacks at regular intervals, which is useful for publishing sensor data or control commands."}),"\n",(0,s.jsx)(n.h3,{id:"timer-implementation",children:"Timer Implementation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\nclass TimerPublisher(Node):\n    def __init__(self):\n        super().__init__('timer_publisher')\n        self.publisher_ = self.create_publisher(String, 'timer_topic', 10)\n\n        # Create a timer that fires every 0.5 seconds\n        timer_period = 0.5  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n        self.i = 0\n\n    def timer_callback(self):\n        msg = String()\n        msg.data = f'Timer message {self.i}'\n        self.publisher_.publish(msg)\n        self.get_logger().info(f'Published: \"{msg.data}\"')\n        self.i += 1\n\ndef main(args=None):\n    rclpy.init(args=args)\n    timer_publisher = TimerPublisher()\n    try:\n        rclpy.spin(timer_publisher)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        timer_publisher.destroy_node()\n        rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsx)(n.h2,{id:"advanced-publishersubscriber-patterns",children:"Advanced Publisher/Subscriber Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"quality-of-service-qos-settings",children:"Quality of Service (QoS) Settings"}),"\n",(0,s.jsx)(n.p,{children:"QoS settings allow fine-tuning of communication behavior:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, QoSDurabilityPolicy, QoSHistoryPolicy, QoSReliabilityPolicy\n\n# Create a QoS profile for sensor data\nsensor_qos = QoSProfile(\n    depth=10,\n    durability=QoSDurabilityPolicy.VOLATILE,\n    reliability=QoSReliabilityPolicy.RELIABLE,\n    history=QoSHistoryPolicy.KEEP_LAST\n)\n\npublisher = node.create_publisher(String, 'sensor_topic', sensor_qos)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"publisher-with-custom-message-types",children:"Publisher with Custom Message Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# Assuming you have a custom message type\nfrom my_package.msg import CustomMessage\n\nclass CustomPublisher(Node):\n    def __init__(self):\n        super().__init__('custom_publisher')\n        self.publisher_ = self.create_publisher(CustomMessage, 'custom_topic', 10)\n\n    def publish_custom_message(self, value1, value2):\n        msg = CustomMessage()\n        msg.field1 = value1\n        msg.field2 = value2\n        self.publisher_.publish(msg)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"running-the-examples",children:"Running the Examples"}),"\n",(0,s.jsx)(n.h3,{id:"setup-instructions",children:"Setup Instructions"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Make sure your ROS 2 environment is sourced:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"source /opt/ros/humble/setup.bash\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Navigate to your workspace directory where you want to run the examples."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Create Python files with the examples above and save them with ",(0,s.jsx)(n.code,{children:".py"})," extensions."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Make the files executable:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chmod +x your_file.py\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"running-parameter-example",children:"Running Parameter Example"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Run the parameter node with custom values:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'ros2 run your_package parameter_node --ros-args -p frequency:=2.0 -p message:="Custom Message"\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"running-action-example",children:"Running Action Example"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Open a terminal and run the action server:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"python3 fibonacci_action_server.py\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"In another terminal, run the action client:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"python3 fibonacci_action_client.py\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsx)(n.p,{children:"In this chapter, you learned advanced Python-to-ROS control techniques:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Parameters"}),": How to configure nodes externally with type-safe parameters"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Actions"}),": Goal-oriented communication pattern with feedback and cancellation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Timers"}),": How to execute callbacks at regular intervals"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"QoS Settings"}),": How to fine-tune communication behavior for different use cases"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These advanced patterns are essential for building robust and configurable robotic applications in ROS 2."})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,n,i){i.d(n,{R:()=>a,x:()=>t});var r=i(6540);const s={},l=r.createContext(s);function a(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);